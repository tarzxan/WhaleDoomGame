<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DOOM-Inspired Shooter</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(45deg, #1a1a1a, #2d2d2d);
            color: #ff6b6b;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none; /* Prevent default touch behaviors */
        }

        #gameContainer {
            position: relative;
            width: 800px;
            height: 600px;
            border: 2px solid #ff6b6b;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }

        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
        }

        .screen.hidden {
            display: none;
        }

        .menu-content, .instructions-content, .game-over-content {
            text-align: center;
            padding: 20px;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            color: #ff6b6b;
        }

        h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            color: #ff6b6b;
        }

        .menu-button {
            background: linear-gradient(45deg, #ff6b6b, #ff5252);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            min-width: 200px;
        }

        .menu-button:hover {
            background: linear-gradient(45deg, #ff5252, #ff6b6b);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .menu-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
            max-width: 600px;
        }

        .control-item {
            background: rgba(255, 107, 107, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .control-item i {
            font-size: 1.5rem;
            margin-bottom: 10px;
            display: block;
            color: #ff6b6b;
        }

        #gameCanvas {
            background: #000;
            display: block;
            border-radius: 8px;
        }

        #gameUI {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            z-index: 10;
        }

        .ui-panel {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid #ff6b6b;
        }

        .ui-item {
            color: #ff6b6b;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .ui-item i {
            margin-right: 8px;
            color: #ff6b6b;
        }

        .final-stats {
            margin: 20px 0;
        }

        .stat-item {
            background: rgba(255, 107, 107, 0.1);
            padding: 10px 20px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .stat-item i {
            margin-right: 10px;
            color: #ff6b6b;
        }

        .game-over-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        #gameOver.victory h2 {
            color: #4CAF50;
        }

        #gameOver.victory .game-over-content {
            color: #4CAF50;
        }

        /* Mobile Controls */
        #mobileControls {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 20;
        }

        #joystickContainer {
            position: absolute;
            bottom: 30px;
            left: 30px;
            width: 140px;
            height: 140px;
            background: rgba(255, 107, 107, 0.2);
            border: 3px solid #ff6b6b;
            border-radius: 50%;
            pointer-events: all;
        }

        #joystickBase {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
        }

        #joystickKnob {
            position: absolute;
            width: 60px;
            height: 60px;
            background: #ff6b6b;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.05s;
        }

        #shootHint {
            position: absolute;
            bottom: 60px;
            right: 30px;
            color: #ff6b6b;
            font-size: 1.4rem;
            font-weight: bold;
            opacity: 0.7;
            pointer-events: none;
        }

        /* Responsive */
        @media (max-width: 820px) {
            #gameContainer {
                width: 100vw;
                height: 100vh;
                border: none;
                border-radius: 0;
            }

            #gameCanvas {
                width: 100%;
                height: 100%;
            }

            h1 { font-size: 2.5rem; }
            .menu-button { min-width: 180px; font-size: 1.1rem; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- Game Menu -->
        <div id="menu" class="screen">
            <div class="menu-content">
                <h1><i class="fas fa-crosshairs"></i> DOOM SHOOTER</h1>
                <button id="startButton" class="menu-button">
                    <i class="fas fa-play"></i> START GAME
                </button>
                <button id="instructionsButton" class="menu-button">
                    <i class="fas fa-info-circle"></i> INSTRUCTIONS
                </button>
            </div>
        </div>

        <!-- Instructions Screen -->
        <div id="instructions" class="screen hidden">
            <div class="instructions-content">
                <h2><i class="fas fa-gamepad"></i> CONTROLS</h2>
                <div class="controls-grid">
                    <div class="control-item">
                        <i class="fas fa-arrow-up"></i>
                        <span>W/S - Move Forward/Back</span>
                    </div>
                    <div class="control-item">
                        <i class="fas fa-arrows-alt-h"></i>
                        <span>A/D - Strafe Left/Right</span>
                    </div>
                    <div class="control-item">
                        <i class="fas fa-mouse"></i>
                        <span>Mouse/Touch - Look & Shoot</span>
                    </div>
                    <div class="control-item">
                        <i class="fas fa-bullseye"></i>
                        <span>Survive the waves!</span>
                    </div>
                </div>
                <button id="backButton" class="menu-button">
                    <i class="fas fa-arrow-left"></i> BACK
                </button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen hidden">
            <div id="gameUI">
                <div class="ui-panel">
                    <div class="ui-item">
                        <i class="fas fa-heart"></i>
                        <span>Health: <span id="healthDisplay">100</span></span>
                    </div>
                    <div class="ui-item">
                        <i class="fas fa-crosshairs"></i>
                        <span>Score: <span id="scoreDisplay">0</span></span>
                    </div>
                    <div class="ui-item">
                        <i class="fas fa-skull"></i>
                        <span>Enemies: <span id="enemiesDisplay">5</span></span>
                    </div>
                </div>
            </div>
            <canvas id="gameCanvas" width="800" height="600"></canvas>

            <!-- Mobile Controls -->
            <div id="mobileControls">
                <div id="joystickContainer">
                    <div id="joystickBase"></div>
                    <div id="joystickKnob"></div>
                </div>
                <div id="shootHint">TAP RIGHT TO SHOOT</div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOver" class="screen hidden">
            <div class="game-over-content">
                <h2 id="gameOverTitle"><i class="fas fa-skull-crossbones"></i> GAME OVER</h2>
                <div class="final-stats">
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <span>Time Survived: <span id="timeSurvived">0</span>s</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-skull"></i>
                        <span>Enemies Killed: <span id="finalKills">0</span></span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-layer-group"></i>
                        <span>Wave Reached: <span id="finalWave">0</span></span>
                    </div>
                </div>
                <div class="game-over-buttons">
                    <button id="restartButton" class="menu-button">
                        <i class="fas fa-redo"></i> PLAY AGAIN
                    </button>
                    <button id="menuButton" class="menu-button">
                        <i class="fas fa-home"></i> MAIN MENU
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SpriteManager {
            constructor() {
                this.sprites = {};
                this.imagesLoaded = false;
            }

            async initializeSprites() {
                const imagePaths = {
                    player: 'assets/images/player.png',
                    enemy: 'assets/images/enemy.png',
                    gun: 'assets/images/gun.png',
                    bullet: 'assets/images/bullet.png',
                    powerup: 'assets/images/powerup.png',
                    particle: 'assets/images/particle.png',
                    explosion: [
                        'assets/images/explosion_0.png',
                        'assets/images/explosion_1.png',
                        'assets/images/explosion_2.png',
                        'assets/images/explosion_3.png',
                        'assets/images/explosion_4.png',
                        'assets/images/explosion_5.png',
                        'assets/images/explosion_6.png',
                        'assets/images/explosion_7.png'
                    ]
                };

                try {
                    this.sprites.player = await this.loadImage(imagePaths.player);
                    this.sprites.enemy = await this.loadImage(imagePaths.enemy);
                    this.sprites.gun = imagePaths.gun ? await this.loadImage(imagePaths.gun) : this.createGunSprite();
                    this.sprites.bullet = this.createBulletSprite();
                    this.sprites.powerup = this.createPowerUpSprite();
                    this.sprites.particle = this.createParticleSprite();
                    this.sprites.explosion = this.createExplosionSprites();
                    this.imagesLoaded = true;
                } catch (error) {
                    console.error('Failed to load sprites:', error);
                    this.fallbackToCanvasSprites();
                }
            }

            loadImage(src) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.src = src;
                    img.onload = () => resolve(img);
                    img.onerror = () => reject(new Error(`Failed to load image: ${src}`));
                });
            }

            fallbackToCanvasSprites() {
                this.sprites.player = this.createPlayerSprite();
                this.sprites.enemy = this.createEnemySprite();
                this.sprites.gun = this.createGunSprite();
                this.sprites.bullet = this.createBulletSprite();
                this.sprites.explosion = this.createExplosionSprites();
                this.sprites.particle = this.createParticleSprite();
                this.sprites.powerup = this.createPowerUpSprite();
                this.imagesLoaded = true;
            }

            // All your create*Sprite methods remain the same (player, enemy, gun, bullet, explosion, particle, powerup)
            // ... (omitted for brevity, copy from your original code)

            createPlayerSprite() {
                const canvas = document.createElement('canvas');
                canvas.width = 32;
                canvas.height = 32;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(12, 8, 8, 16);
                ctx.fillStyle = '#90EE90';
                ctx.fillRect(14, 6, 4, 4);
                ctx.fillStyle = '#228B22';
                ctx.fillRect(10, 12, 4, 8);
                ctx.fillRect(18, 12, 4, 8);
                ctx.fillStyle = '#006400';
                ctx.fillRect(12, 20, 8, 8);
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(22, 14, 6, 2);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(15, 7, 1, 1);
                ctx.fillRect(17, 7, 1, 1);
                return canvas;
            }

            createEnemySprite() {
                const canvas = document.createElement('canvas');
                canvas.width = 32;
                canvas.height = 32;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(12, 8, 8, 16);
                ctx.fillStyle = '#ff6666';
                ctx.fillRect(14, 6, 4, 4);
                ctx.fillStyle = '#cc0000';
                ctx.fillRect(10, 12, 4, 8);
                ctx.fillRect(18, 12, 4, 8);
                ctx.fillStyle = '#990000';
                ctx.fillRect(12, 20, 8, 8);
                ctx.fillStyle = '#660000';
                ctx.fillRect(13, 4, 2, 2);
                ctx.fillRect(17, 4, 2, 2);
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(15, 7, 1, 1);
                ctx.fillRect(17, 7, 1, 1);
                return canvas;
            }

            createGunSprite() {
                const canvas = document.createElement('canvas');
                canvas.width = 64;
                canvas.height = 64;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#808080';
                ctx.fillRect(20, 20, 32, 12);
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(20, 32, 12, 20);
                ctx.fillStyle = '#404040';
                ctx.fillRect(20, 32, 8, 8);
                return canvas;
            }

            createBulletSprite() {
                const canvas = document.createElement('canvas');
                canvas.width = 8;
                canvas.height = 8;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(2, 2, 4, 4);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(3, 3, 2, 2);
                return canvas;
            }

            createExplosionSprites() {
                const explosions = [];
                for (let frame = 0; frame < 8; frame++) {
                    const canvas = document.createElement('canvas');
                    canvas.width = 32;
                    canvas.height = 32;
                    const ctx = canvas.getContext('2d');
                    const size = 4 + frame * 3;
                    const alpha = 1 - (frame / 8);
                    ctx.globalAlpha = alpha;
                    ctx.fillStyle = '#ff6600';
                    ctx.fillRect(16 - size/2, 16 - size/2, size, size);
                    ctx.fillStyle = '#ffff00';
                    ctx.fillRect(16 - size/3, 16 - size/3, size/1.5, size/1.5);
                    ctx.fillStyle = '#ff0000';
                    ctx.fillRect(16 - size/4, 16 - size/4, size/2, size/2);
                    explosions.push(canvas);
                }
                return explosions;
            }

            createParticleSprite() {
                const canvas = document.createElement('canvas');
                canvas.width = 4;
                canvas.height = 4;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(1, 1, 2, 2);
                return canvas;
            }

            createPowerUpSprite() {
                const canvas = document.createElement('canvas');
                canvas.width = 24;
                canvas.height = 24;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(8, 8, 8, 8);
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(10, 9, 4, 2);
                ctx.fillRect(11, 8, 2, 4);
                return canvas;
            }

            drawSprite(ctx, spriteType, x, y, rotation = 0, scale = 1, frame = 0) {
                const sprite = this.sprites[spriteType];
                if (!sprite || !this.imagesLoaded) return;

                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(rotation);
                ctx.scale(scale, scale);

                if (Array.isArray(sprite)) {
                    const frameIndex = Math.min(frame, sprite.length - 1);
                    ctx.drawImage(sprite[frameIndex], -sprite[frameIndex].width/2, -sprite[frameIndex].height/2);
                } else {
                    ctx.drawImage(sprite, -sprite.width/2, -sprite.height/2);
                }

                ctx.restore();
            }

            createParticleEffect(x, y, color, count = 10) {
                const particles = [];
                for (let i = 0; i < count; i++) {
                    particles.push({
                        x, y,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10,
                        life: 1.0,
                        decay: 0.02 + Math.random() * 0.03,
                        color,
                        size: 2 + Math.random() * 3
                    });
                }
                return particles;
            }

            updateParticles(particles) {
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vx *= 0.98;
                    p.vy *= 0.98;
                    p.life -= p.decay;
                    if (p.life <= 0) particles.splice(i, 1);
                }
            }

            drawParticles(ctx, particles) {
                // fallback and image versions unchanged
                // ... (copy from original)
            }

            createMuzzleFlash(ctx, x, y, angle) {
                const flashLength = 20;
                const flashWidth = 8;
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(angle);
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(0, -flashWidth/4, flashLength, flashWidth/2);
                ctx.fillStyle = '#ff6600';
                ctx.fillRect(0, -flashWidth/2, flashLength * 0.8, flashWidth);
                ctx.restore();
            }
        }

        // SoundManager unchanged (copy from your original code)
        // ... (all SoundManager code)

        class Game {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.spriteManager = new SpriteManager();
                this.soundManager = new SoundManager();

                this.gameState = 'menu';
                this.score = 0;
                this.enemiesKilled = 0;
                this.waveNumber = 1;

                this.fov = Math.PI / 3;
                this.halfFov = this.fov / 2;
                this.numRays = this.canvas.width / 2;
                this.maxDepth = 800;
                this.wallHeight = 100;

                this.mapWidth = 20;
                this.mapHeight = 15;
                this.tileSize = 32;
                this.map = this.generateMap();

                this.player = null;
                this.bullets = [];
                this.enemies = [];
                this.particles = [];
                this.explosions = [];
                this.powerUps = [];

                this.keys = {};
                this.lastShotTime = 0;
                this.shotCooldown = 150;
                this.mouseSensitivity = 0.0015;

                this.powerUpSpawnChance = 0.001;
                this.waveCooldown = 60000;
                this.waveTimer = 0;
                this.waitingForNextWave = false;
                this.enemiesPerWave = 5;
                this.maxWaves = 7;

                // Mobile support
                this.isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                this.virtualKeys = { w: false, a: false, s: false, d: false };
                this.joystickActive = false;
                this.joystickCenter = { x: 0, y: 0 };
                this.lookTouchId = null;
                this.lastLookX = 0;

                this.spriteManager.initializeSprites().then(() => {
                    this.initializeEventListeners();
                    this.initializeUI();
                    this.gameLoop();
                });
            }

            // ... all your original methods (generateMap, spawnEnemies, etc.) unchanged

            initializeEventListeners() {
                // Keyboard (desktop)
                document.addEventListener('keydown', (e) => {
                    this.keys[e.key.toLowerCase()] = true;
                    if (['w', 'a', 's', 'd'].includes(e.key.toLowerCase())) e.preventDefault();
                });
                document.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                });

                // Mouse (desktop)
                this.canvas.addEventListener('mousemove', (e) => {
                    if (this.gameState !== 'playing' || this.isMobile) return;
                    const rect = this.canvas.getBoundingClientRect();
                    const deltaX = (e.clientX - rect.left) * (this.canvas.width / rect.width) - this.canvas.width / 2;
                    if (this.player) this.player.angle += deltaX * this.mouseSensitivity * 0.5;
                });

                this.canvas.addEventListener('mousedown', (e) => {
                    if (this.isMobile || this.gameState !== 'playing') return;
                    this.handleShooting();
                });

                this.canvas.addEventListener('contextmenu', (e) => e.preventDefault());

                // Mobile controls
                if (this.isMobile) this.setupMobileControls();
            }

            setupMobileControls() {
                const joystickContainer = document.getElementById('joystickContainer');
                const knob = document.getElementById('joystickKnob');

                joystickContainer.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    this.joystickActive = true;
                    const rect = joystickContainer.getBoundingClientRect();
                    this.joystickCenter = {
                        x: rect.left + rect.width / 2,
                        y: rect.top + rect.height / 2
                    };
                    this.updateJoystick(touch, knob);
                });

                joystickContainer.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    if (!this.joystickActive) return;
                    const touch = Array.from(e.touches).find(t => t.identifier === e.touches[0].identifier);
                    if (touch) this.updateJoystick(touch, knob);
                });

                document.addEventListener('touchend', (e) => {
                    if (this.joystickActive && e.touches.length === 0) {
                        this.joystickActive = false;
                        this.virtualKeys = { w: false, a: false, s: false, d: false };
                        knob.style.transform = 'translate(-50%, -50%)';
                    }
                    if (this.lookTouchId !== null && !Array.from(e.touches).some(t => t.identifier === this.lookTouchId)) {
                        this.lookTouchId = null;
                    }
                });

                // Right side look + shoot
                this.canvas.addEventListener('touchstart', (e) => {
                    if (this.gameState !== 'playing') return;
                    for (let touch of e.touches) {
                        const rect = this.canvas.getBoundingClientRect();
                        const x = touch.clientX - rect.left;
                        if (x > rect.width / 2) {
                            if (this.lookTouchId === null) {
                                this.lookTouchId = touch.identifier;
                                this.lastLookX = touch.clientX;
                            }
                            this.handleShooting();
                        }
                    }
                });

                this.canvas.addEventListener('touchmove', (e) => {
                    if (this.gameState !== 'playing' || !this.player) return;
                    for (let touch of e.touches) {
                        if (touch.identifier === this.lookTouchId) {
                            const deltaX = touch.clientX - this.lastLookX;
                            this.player.angle += deltaX * 0.006; // mobile look sensitivity
                            this.lastLookX = touch.clientX;
                        }
                    }
                });
            }

            updateJoystick(touch, knob) {
                const dx = touch.clientX - this.joystickCenter.x;
                const dy = touch.clientY - this.joystickCenter.y;
                const dist = Math.min(60, Math.hypot(dx, dy));
                const angle = Math.atan2(dy, dx);

                const knobX = Math.cos(angle) * dist;
                const knobY = Math.sin(angle) * dist;
                knob.style.transform = `translate(calc(-50% + ${knobX}px), calc(-50% + ${knobY}px))`;

                const threshold = 20;
                this.virtualKeys.w = knobY < -threshold;
                this.virtualKeys.s = knobY > threshold;
                this.virtualKeys.a = knobX < -threshold;
                this.virtualKeys.d = knobX > threshold;
            }

            startGame() {
                // ... original startGame code
                this.gameState = 'playing';
                // reset everything...

                if (this.isMobile) {
                    document.getElementById('mobileControls').style.display = 'block';
                }
                // rest unchanged
            }

            // In Player.update, use effective keys
            // (You'll need to pass `game` to player.update and use game.isMobile ? game.virtualKeys : keys)

            // All other methods unchanged
        }

        class Player {
            constructor(x, y, angle) {
                // unchanged
            }

            update(keys, game) {
                const effectiveKeys = game.isMobile ? game.virtualKeys : keys;

                let moveX = 0;
                let moveY = 0;
                if (effectiveKeys.w) {
                    moveX += Math.cos(this.angle) * this.speed;
                    moveY += Math.sin(this.angle) * this.speed;
                }
                if (effectiveKeys.s) {
                    moveX -= Math.cos(this.angle) * this.speed;
                    moveY -= Math.sin(this.angle) * this.speed;
                }
                if (effectiveKeys.a) {
                    moveX += Math.cos(this.angle - Math.PI/2) * this.speed;
                    moveY += Math.sin(this.angle - Math.PI/2) * this.speed;
                }
                if (effectiveKeys.d) {
                    moveX += Math.cos(this.angle + Math.PI/2) * this.speed;
                    moveY += Math.sin(this.angle + Math.PI/2) * this.speed;
                }

                // collision and movement unchanged
                // ...
            }

            // rest unchanged
        }

        // Enemy, Bullet, Explosion, PowerUp unchanged

        document.addEventListener('DOMContentLoaded', () => {
            const game = new Game();
        });
    </script>
</body>
</html>
